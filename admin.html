<!DOCTYPE html>

<head>
<meta charset='utf-8' />


<link href='../lib/fullcalendar.min.css' rel='stylesheet' />
<link href='../lib/fullcalendar.print.min.css' rel='stylesheet' media='print' />
<link href='../scheduler.min.css' rel='stylesheet' />
<link rel="stylesheet" href="http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" /> 
<script src='https://momentjs.com/downloads/moment.js'></script> 
<script src='../lib/jquery.min.js'></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src='../lib/fullcalendar.min.js'></script>
<script src='../scheduler.min.js'></script>




<!-- <script>
// jQuery import 바로아래에 넣어 주면 됩니다.
// Cannot read property 'msie' of undefined 에러 나올때
jQuery.browser = {};
(function () {
    jQuery.browser.msie = false;
    jQuery.browser.version = 0;
    if (navigator.userAgent.match(/MSIE ([0-9]+)\./)) {
        jQuery.browser.msie = true;
        jQuery.browser.version = RegExp.$1;
    }
})();
</script> -->



<div class="modalWindow_container" id='modal1'>
    <div class="modalWindow">   
    
    <div style='text-align:center'>
    <div class= "modalButton" id='button_Regular'>정기예약</div>
    <div class= "modalButton" id='button_Day' >보강예약</div>
    <div class= "modalButton" id='button_Null' >널로 예약</div>
    <div class= "modalButton" id='button_Cancel'>취소</div>
    
    </div>
    </div>
</div>

<div class="modalWindow_container" id='modal2'>
    <div class="modalWindow">   
    
    <div style='text-align:center'>
    <div class= "modalButton"id='button_Extend'>수업 연장</div>
    <div class= "modalButton"id='button_CancelCourse' >수업 취소</div>
    <div class= "modalButton"id='button_DeleteCourse' >수업 삭제</div>
    <div class= "modalButton"id='button_Cancel2'>취소</div>
    
    </div>
    </div>
</div>

<div class="modalWindow_container" id='modal3'>
    <div class="modalWindow">   
    
    <div style='text-align:center'>
    <input class= "datepicker" type="text" id="startDatepicker" placeholder="시작 날짜">
    <input class = "modalButton" type="text" id="et_startTime" placeholder = "00:00" value="00:00">
    <div></div>
    <input class= "datepicker" type="text" id="endDatepicker" placeholder="종료 날짜">
    <input class = "modalButton" type="text" id="et_endTime" placeholder = "23:59" value="23:59">
    <div></div>
    <input class= "modalButton" type="text" id="closeBranch" placeholder="지점">
    <input class = "modalButton" type="text" id="closeTeacher" placeholder = "선생님">
    <div></div>
    <label class="modalButton" ><input class = "modalButton" type="checkbox" id = "cb_cancel" value="1">수업도 취소</label>
    <div></div>
    <div class= "modalButton"id='button_Ok3' style="display: inline-block;">확인</div>
    <div class= "modalButton"id='button_Cancel3' style="display: inline-block;">취소</div>
    
    </div>
    </div>
</div>
<div class="modalWindow_container" id='modal_open'>
    <div class="modalWindow">   
    
    <div style='text-align:center'>
    <input class= "datepicker" type="text" id="startOpenDatepicker" placeholder="시작 날짜">
    <input class = "modalButton" type="text" id="et_openStartTime" placeholder = "00:00" value="00:00">
    <div></div>
    <input class= "datepicker" type="text" id="endOpenDatepicker" placeholder="종료 날짜">
    <input class = "modalButton" type="text" id="et_openEndTime" placeholder = "23:59" value="23:59">
    <div></div>
    <input class= "modalButton" type="text" id="openBranch" placeholder="지점">
    <input class = "modalButton" type="text" id="openTeacher" placeholder = "선생님">
    <div></div>
    <div class= "modalButton"id='button_Ok_Open' style="display: inline-block;">확인</div>
    <div class= "modalButton"id='button_Cancel_Open' style="display: inline-block;">취소</div>
    
    </div>
    </div>
</div>

<div class="modalWindow_container" id='modal_extend'>
    <div class="modalWindow">   
    
    <div style='text-align:center'>
    <input class= "datepicker" type="text" id="startTermPicker" placeholder="시작 날짜">
    <div></div>
    <input class= "datepicker" type="text" id="endTermPicker" placeholder="종료 날짜">
    <div></div>
    <div class= "modalButton"id='button_Ok_extend' style="display: inline-block;">확인</div>
    <div class= "modalButton"id='button_Cancel_extend' style="display: inline-block;">취소</div>
    
    </div>
    </div>
</div>

<div class="modalWindow_container" id='modal_teacherTime' >
    <div class="modalWindow">   
    
    <div style='text-align:center'>
    <input class= "modalButton" type="text" id="timeBranch" placeholder="지점">
    <input class = "modalButton" type="text" id="timeTeacher" placeholder = "선생님">
    <div></div>
    <input class= "modalButton" type="text" id="timeStart" placeholder="시작시간">
    <input class = "modalButton" type="text" id="timeEnd" placeholder = "끝나는시간">
    <input class = "modalButton" type="text" id="courseDay" placeholder = "요일">
    <div></div>
    <div class= "modalButton"id='button_Ok_teacher' style="display: inline-block;">등록</div>
    <div class= "modalButton"id='button_Delete_teacher' style="display: inline-block;">제거</div>
    <div class= "modalButton"id='button_Cancel_teacher' style="display: inline-block;">취소</div>
    
    </div>
    </div>
</div>

<div class="modalWindow_container" id='modal_Teacher'>
    <div class="modalWindow">   
    
    <div style='text-align:center'>
    <input class= "modalButton" type="text" id="teacherBranch" placeholder="지점">
    <input class = "modalButton" type="text" id="teacherName" placeholder = "선생님">
    <input class = "modalButton" type="text" id="teacherColor" placeholder = "색깔">
    <div></div>
    <div class= "modalButton"id='button_Ok_TeacherRegister' style="display: inline-block;">등록</div>
    <div class= "modalButton"id='button_Delete_TeacherOut' style="display: inline-block;">제거</div>
    <div class= "modalButton"id='button_Cancel_TeacherInfo' style="display: inline-block;">취소</div>
    
    </div>
    </div>
</div>

<div class="modalWindow_container" id='modal_null'>
    <div class="modalWindow">   
    
    <div style='text-align:center'>
    <input class= "modalButton" type="text" id="nullUserID" placeholder="유저아이디">
    <input class = "modalButton" type="text" id="nullUserBranch" placeholder = "지점">
    <input class = "modalButton" type="text" id="nullUserTeacher" placeholder = "선생님">
    <div></div>
    <div class= "modalButton"id='button_Ok_null' style="display: inline-block;">등록</div>
    <div class= "modalButton"id='button_Cancel_null' style="display: inline-block;">취소</div>
    
    </div>
    </div>
</div>





<?php
    /* Displays user information and some useful messages */
    session_start();

    // Check if user is logged in using the session variable
    if ( $_SESSION['logged_in'] != 1 ) {
      $_SESSION['message'] = "You must log in before viewing your profile page!";
      header("location: error.php");    
    }
    else {
        
        $userName = $_SESSION['userName'];
        $userBranch = $_SESSION['userBranch'];
        $userID = $_SESSION['userID'];
        $userType = $_SESSION['userType'];
        $userDuration = $_SESSION['userDuration'];
        $admin = False;
        
        
    }

    if($userName != "admin")
    {
        
        $_SESSION['message'] = "You have no authority to access this page!";
        header("location: error.php");
    }
?>
<script>

    function showModal(id, anim) {

      var container = document.getElementById(id);
      var box = container.querySelector('.modalWindow');

      // inital value
      box.style.transition = 'none';
      if (anim == 'rotate')
        box.style.transform = 'rotateY(-70deg)';
      else
        box.style.transform = 'scale(0,0)';

      var ok = box.querySelector('.ok');


      requestAnimationFrame(function() {


        box.style.transition = 'all 0.5s ease';

        if (anim == 'rotate')
          box.style.transform = 'rotateY(0deg)';
        else
          box.style.transform = 'scale(1,1)';
      });

      container.style.pointerEvents = 'auto';
      container.style.opacity = 1;
    }

    // function hideModal() {
    //   var container = document.querySelector('.modalWindow_container');
    //   container.style.opacity = 0;
    //   container.style.pointerEvents = 'none';
    // }
    // function hideSecondModal() {
    //   var container = document.querySelector('#modal2');
    //   container.style.opacity = 0;
    //   container.style.pointerEvents = 'none';
    // }
    // function hideThirdModal() {
    //   var container = document.querySelector('#modal3');
    //   container.style.opacity = 0;
    //   container.style.pointerEvents = 'none';
    // }
    // function hideOpenModal()
    // {
    //   var container = document.querySelector('#modal_open');
    //   container.style.opacity = 0;
    //   container.style.pointerEvents = 'none';
    // }
    // function hideExtendModal()
    // {
    //   var container = document.querySelector('#modal_extend');
    //   container.style.opacity = 0;
    //   container.style.pointerEvents = 'none';
    // }
    // function hideTeacherModal()
    // {
    //   var container = document.querySelector('#modal_teacherTime');
    //   container.style.opacity = 0;
    //   container.style.pointerEvents = 'none';
    // }
    // function hideTeacherInfoModal()
    // {
    //   var container = document.querySelector('#modal_Teacher');
    //   container.style.opacity = 0;
    //   container.style.pointerEvents = 'none';
    // }
    function hideModal(id)
    { 
      var container = document.querySelector("[id="+id +"]");
      container.style.opacity = 0;
      container.style.pointerEvents = 'none';
    
    }

    function makeWhite(dowlist){
        var view = $('#calendar').fullCalendar('getView');
        var viewstart = view.start;
        var viewend = view.end;
        //makeWhite(dowlist,viewstart, viewend);
        var dateforcolor = [];
        for(var j = 0; j < dowlist.length; j++)
        {
                    
            var tmp = viewstart.clone().day(dowlist[j]);
            if( tmp.isAfter(viewstart, 'd') ){
                dateforcolor.push(tmp.format('YYYY-MM-DD'));
            }
            while( tmp.isBefore(viewend) ){
                tmp.add(7, 'days');
                dateforcolor.push(tmp.format('YYYY-MM-DD'));
            }
                    
        }
        console.log(dateforcolor);
        for(var i = 0; i < dateforcolor.length; i++)
        {
                    
            $('.fc-day[data-date="' + dateforcolor[i] + '"]').css('background', 'white');
        }     
        

    }

    
 
    
    $(document).ready(function() {
        var originalDate;
        var idlist = [];
        var dowlist = [];
        var ownTeacherView = false;
        var ownIDView = false;
        var searchTeacher = false;
        var allView = true;
        var searchedTeacher = "";
        
        var userID, userDuration;
        var userBranch = '<?php echo $userBranch; ?>';
        var userName = '<?php echo $userName; ?>';
        var cur_termStart;
        var cur_termEnd;
        var termList = [];
        var userInfo = [];

        var day_selectStart, day_teacher;
        var event_Start, event_title,event_Teacher, event_End;

        $( ".datepicker" ).datepicker({
            showOn: "both"
        });



        function acceptRegular(teacher, selectStart)
        {
            //$pt_courseTeacher, $pt_courseBranch,$startTime, $endTime ,$startDate, $pt_userID,$dow,$userName
            if(!userID)
            {
                alert("먼저 학생 정보를 등록해주세요!");
                return;
            }

            jQuery.ajax({
                url: "http://show981111.cafe24.com/acceptRegular.php",
                type: 'POST',
                data: {
                    pt_courseTeacher : teacher,
                    pt_courseBranch : userBranch,
                    pt_userID : userID,
                    pt_startTime : selectStart,
                    pt_startDateAndDow : userDuration,
                    reject : "web"// courseDay and startTime will calculated at php
                    // $pt_courseTeacher = $_POST['pt_courseTeacher'];
                    // $pt_courseBranch = $_POST['pt_courseBranch'];
                    // $pt_userID = $_POST['pt_userID'];
                    // $pt_startTime = $_POST['pt_startTime'];//15:00 ~ 16:00
                    // $pt_startDateAndDow = $_POST['pt_startDateAndDow'];// 2020-02-06 월
                    // $pt_reject = $_POST['reject'];
                
                },
                success: function(data) {
                    console.log(data);
                    switch(data)
                    {
                        case "success":
                            alert("성공적으로 예약하였습니다!")
                            $("#calendar").fullCalendar('refetchEvents');
                            break;
                        case "notEmpty":
                            alert("빈 시간대가 아닙니다.")
                            break;
                        case "already":
                            alert("이미 예약되어 있습니다.")
                            break;
                        case "fail":
                            alert("실패하였습니다.")
                            break;
                        case "nothingTodelete":
                            alert("성공적으로 예약하였습니다!")
                            $("#calendar").fullCalendar('refetchEvents');
                            break;
                        default:
                            alert("인터넷 연결을 확인해주세요.")
                            break;
                    }   
                },

                error: function(xhr, textStatus, error){
                    alert("인터넷 연결을 확인해주세요.")
                    console.log(xhr.statusText);
                    console.log(textStatus);
                    console.log(error);
                }
            });
        }

        function changeDay(selectStart, teacher, isNull)
        {
            if(!userID)
            {
                alert("먼저 학생 정보를 등록해주세요!");
                return;
            }
            console.log("changeDay Called");
            var canceledList = [];
            jQuery.ajax({//get if there are canceled Date 
                url: "http://show981111.cafe24.com/getBookedList.php",
                type: 'POST',
                data: {
                    userID : userID,
                    option : "cancelAll"
                
                },
                success: function(data) {
                    console.log(data);
                    var output = JSON.parse(data);
                    
                    $.each(output, function (i, item) {

                        canceledList.push({
                            bookedTeacher: output[i].bookedTeacher,
                            bookedBranch: output[i].bookedBranch,
                            bookedStartDate: output[i].bookedStartDate, 
                            bookedEndDate: output[i].bookedEndDate
                        });
                    })

                    if(canceledList.length > 0 || isNull)
                    {
                        var canceledDate = "admin";
                        if(canceledList.length > 0)
                        {   
                            console.log(canceledList);
                            var canceledDate = canceledList[(canceledList.length - 1)]["bookedStartDate"];
                            console.log(canceledDate);
                        }
                        console.log(userBranch);
                        console.log(teacher);
                        jQuery.ajax({
                            url: "http://show981111.cafe24.com/putNewlyDate.php",
                            type: 'POST',
                            data: {
                                courseTeacher : teacher,
                                courseBranch : userBranch,
                                userID : userID,
                                startDate : selectStart,
                                canceledDate : canceledDate,
                                userDuration : userDuration,
                                userName : userName
                            
                            },
                            success: function(data) {
                                console.log(data);
                                switch(data)
                                {
                                    case "success":
                                        alert("성공적으로 예약하였습니다.")
                                        $("#calendar").fullCalendar('refetchEvents');
                                        break;
                                    case "past":
                                        alert("오늘날짜와 시작날짜를 다시한번 확인해 주세요.")
                                        break;
                                    case "future":
                                        alert("이번학기만 예약이 가능합니다.")
                                        break;
                                    case "timeout":
                                        alert("예약 가능시간이 아닙니다(수업 4시간 전까지 가능합니다.)")
                                        break;
                                    case "isBooked":
                                        alert("빈시간대가 아닙니다.")
                                        break;
                                    case "already":
                                        alert("먼저 수업을 취소해주세요.")
                                        break;
                                    case "noRegular":
                                        alert("정기예약을 먼저 해주세요.")
                                        break;
                                    default:
                                        alert("실패하였습니다.")
                                        break;
                                }   
                            },

                            error: function(xhr, textStatus, error){
                                alert("인터넷 연결을 확인해주세요.")
                                console.log(xhr.statusText);
                                console.log(textStatus);
                                console.log(error);
                            }
                        });
                    }else{
                        alert("먼저 수업을 취소해주세요!");

                    }                        
                },

                error: function(xhr, textStatus, error){
                    alert("인터넷 연결을 확인해주세요.")
                  console.log(xhr.statusText);
                  console.log(textStatus);
                  console.log(error);
                }
            });

        }

        function extendCourse(extendTeacher,extendUserID ,extendStart, extendEnd)
        {

            jQuery.ajax({
                url: "http://show981111.cafe24.com/extendRequest.php",
                type: 'POST',
                data: {
                    extendTeacher : extendTeacher,
                    extendBranch : userBranch,
                    userID : extendUserID,
                    extendStartDate : extendStart,
                    extendEndDate : extendEnd
                
                },
                success: function(data) {
                    console.log(data);
                    if(data.substring(0,1) == 2)
                    {
                        alert("성공적으로 연장하였습니다.")
                        $("#calendar").fullCalendar('refetchEvents');
                    }else
                    {
                        switch(data)
                        {
                            case "timeout":
                                alert("수업시작 4시간 전까지만 연장이 가능합니다.")
                                break;
                            case "notEmpty":
                                alert("빈 시간대가 아닙니다.")
                                break;
                            case "unavailable":
                                alert("연장할 수 없습니다. 수업을 먼저 취소해주세요.")
                                break;
                            default:
                                alert("실패하였습니다.")
                                break;
                        }   
                    }
                },

                error: function(xhr, textStatus, error){
                    alert("인터넷 연결을 확인해주세요.")
                    console.log(xhr.statusText);
                    console.log(textStatus);
                    console.log(error);
                }
            });
        }

        function cancelCourse(cancelTeacher, cancelUserID,cancelStartDate, cancelEndDate)
        {
            console.log(cancelTeacher);
            console.log(cancelStartDate);
            console.log(cancelEndDate);
            //console.log(moment().format("YYYY-MM-DD HH:mm"));
            //var today = moment().format("YYYY-MM-DD HH:mm");
            
            jQuery.ajax({
                url: "http://show981111.cafe24.com/cancelCourse.php",
                type: 'POST',
                data: {
                    cancelTeacher : cancelTeacher,
                    cancelBranch : userBranch,
                    userID : cancelUserID,
                    startDate : cancelStartDate,
                    endDate : cancelEndDate,
                    userName : userName
                
                },
                success: function(data) {
                    console.log(data);
                    switch(data)
                    {
                        case "success":
                            alert("성공적으로 취소하였습니다.")
                            $("#calendar").fullCalendar('refetchEvents');
                            break;
                        case "timeout":
                            alert("수업시작 4시간 전까지만 취소가 가능합니다.")
                            break;
                        case "creditOver":
                            alert("취소가능한 횟수를 초과하였습니다.")
                            break;
                        case "already":
                            alert("이미 취소한 수업입니다.")
                            $("#calendar").fullCalendar('refetchEvents');
                            break;
                        default:
                            alert("실패하였습니다.")
                            break;
                    }   
                    
                },

                error: function(xhr, textStatus, error){
                    alert("인터넷 연결을 확인해주세요.")
                    console.log(xhr.statusText);
                    console.log(textStatus);
                    console.log(error);
                }
            });
        }

        $("#button_Regular").click(function(){
            hideModal('modal1');
            clicked = "Regular";
            acceptRegular(day_teacher,day_selectStart);
            return;
        });
        $("#button_Day").click(function(){
            hideModal('modal1');
            clicked = "buttonDay";
            changeDay(day_selectStart, day_teacher, false);
            return;
        });
        $("#button_Null").click(function(){
            hideModal('modal1');
            changeDay(day_selectStart, day_teacher, true);
            return;
        });
        $("#button_Cancel").click(function(){
            hideModal('modal1');
            return;
        });

        $("#button_Extend").click(function(){
            hideModal('modal2');
            extendCourse(event_Teacher,event_title ,event_Start, event_End);
            return;
        });
        $("#button_DeleteCourse").click(function(){
            jQuery.ajax({
                url: "http://show981111.cafe24.com/deleteCourse.php",
                type: 'POST',
                data: {
                    userID : event_title,
                    startDate : event_Start
                },
                success: function(data) {
                    console.log(data);
                    switch(data)
                    {
                        case "success":
                            alert("삭제했습니다.")
                            $("#calendar").fullCalendar('refetchEvents');
                            break;
                        default:
                            alert("실패하였습니다.")
                            break;
                    }   
                    
                },

                error: function(xhr, textStatus, error){
                    alert("인터넷 연결을 확인해주세요.")
                    console.log(xhr.statusText);
                    console.log(textStatus);
                    console.log(error);
                }
            });
            hideModal('modal2');
            return;
        });
        $("#button_CancelCourse").click(function(){
            hideModal('modal2');
            cancelCourse(event_Teacher,event_title, event_Start, event_End);
            return;
        });
        $("#button_Cancel2").click(function(){
            hideModal('modal2');
            return;
        });

        $("#button_Cancel3").click(function(){
            hideModal('modal3');
            return;
        });
        $("#button_Ok3").click(function(){
            var closeStartDate = $('#startDatepicker').datepicker({ dateFormat: 'yyyy-mm-dd' }).val();
            var closeStartTime = $('#et_startTime').val();
            var closeEndDate = $('#endDatepicker').datepicker({ dateFormat: 'yyyy-mm-dd' }).val();
            var closeEndTime = $('#et_endTime').val();
            var start = moment(closeStartDate).format("YYYY-MM-DD");
            var tempS = start + " " + closeStartTime;
            var end = moment(closeEndDate).format("YYYY-MM-DD");
            var tempE = end + " " + closeEndTime;
            var isCancel = document.getElementById("cb_cancel").checked;

            
            var startDateTime = moment(tempS).format("YYYY-MM-DD HH:mm");
            var endDateTime = moment(tempE).format("YYYY-MM-DD HH:mm");
            var closeBranch = $('#closeBranch').val();
            var closeTeacher = $('#closeTeacher').val();
            if(isCancel)
            {
                isCancel = "true";
            }else{
                isCancel = "false";
            }

            jQuery.ajax({
                url: "http://show981111.cafe24.com/close.php",
                type: 'POST',
                data: {
                    closeTeacher : closeTeacher,
                    closeBranch : closeBranch,
                    closeStartDate : startDateTime,
                    closeEndDate : endDateTime,
                    isCancel : isCancel
                    
                },
                success: function(data) {
                    console.log(data);
                    switch(data)
                    {
                        case "success":
                            alert("성공적으로 닫았습니다.")
                            $("#calendar").fullCalendar('refetchEvents');
                            break;
                        case "checkTeacher":
                            alert("선생님을 확인해주세요.")
                            break;
                        case "checkBranch":
                            alert("지점을 확인해주세요.")
                            break;
                        case "internet_fail":
                            alert("인터넷연결을 확인해주세요.")
                            break;
                        default:
                            alert("실패하였습니다.")
                            break;
                    }   
                    
                },

                error: function(xhr, textStatus, error){
                    alert("인터넷 연결을 확인해주세요.")
                    console.log(xhr.statusText);
                    console.log(textStatus);
                    console.log(error);
                }
            });
            hideModal('modal3');
            return;
        });
        $("#button_Cancel_Open").click(function(){
            hideModal('modal_open');
            return;
        });
        $("#button_Ok_Open").click(function(){
            
            var openStartDate = $('#startOpenDatepicker').datepicker({ dateFormat: 'yyyy-mm-dd' }).val();
            var openStartTime = $('#et_openStartTime').val();
            var openEndDate = $('#endOpenDatepicker').datepicker({ dateFormat: 'yyyy-mm-dd' }).val();
            var openEndTime =$('#et_openEndTime').val();
            var tempS = moment(openStartDate).format("YYYY-MM-DD");
            var tempE = moment(openEndDate).format("YYYY-MM-DD");

            var openStartDateTime = tempS + " " + openStartTime;
            var openEndDateTime = tempE + " " + openEndTime;
            console.log(openStartDateTime);
            console.log(openEndDateTime);

            var openTeacher = $('#openTeacher').val();
            var openBranch = $('#openBranch').val();

            jQuery.ajax({
                url: "http://show981111.cafe24.com/open.php",
                type: 'POST',
                data: {
                    openTeacher : openTeacher,
                    openBranch : openBranch,
                    openStartDate : openStartDateTime,
                    openEndDate : openEndDateTime
                    
                },
                success: function(data) {
                    console.log(data);
                    switch(data)
                    {
                        case "success":
                            alert("성공적으로 열었습니다.")
                            $("#calendar").fullCalendar('refetchEvents');
                            break;
                        case "checkTeacher":
                            alert("선생님을 확인해주세요.")
                            break;
                        case "checkBranch":
                            alert("지점을 확인해주세요.")
                            break;
                        case "internet_fail":
                            alert("인터넷연결을 확인해주세요.")
                            break;
                        default:
                            alert("실패하였습니다.")
                            break;
                    }   
                    
                },

                error: function(xhr, textStatus, error){
                    alert("인터넷 연결을 확인해주세요.")
                    console.log(xhr.statusText);
                    console.log(textStatus);
                    console.log(error);
                }
            });
            hideModal('modal_open');
            return;
        });

        $("#button_Ok_extend").click(function(){
            var extendStartDate = $('#startTermPicker').datepicker({ dateFormat: 'yyyy-mm-dd' }).val();
            var extendEndDate = $('#endTermPicker').datepicker({ dateFormat: 'yyyy-mm-dd' }).val();
            var tempS = moment(extendStartDate).format("YYYY-MM-DD");
            var tempE = moment(extendEndDate).format("YYYY-MM-DD");
            jQuery.ajax({
                url: "http://show981111.cafe24.com/putExtendTerm.php",
                type: 'POST',
                data: {
                    termStart : tempS,
                    termEnd : tempE
                },
                success: function(data) {
                    console.log(data);
                    switch(data)
                    {
                        case "success":
                            alert("성공적으로 연장하였습니다.")
                            $("#calendar").fullCalendar('refetchEvents');
                            break;
                        case "notMatched":
                            alert("날짜를 확인해주세요.")
                            break;
                        case "fail":
                            alert("날짜를 확인해주세요.")
                            break;
                        case "redunt":
                            alert("이미 연장하였습니다.")
                            break;
                        default:
                            alert("인터넷 연결을 확인해주세요.")
                            break;
                    }   
                    
                },

                error: function(xhr, textStatus, error){
                    alert("인터넷 연결을 확인해주세요.")
                    console.log(xhr.statusText);
                    console.log(textStatus);
                    console.log(error);
                }
            });
            hideModal('modal_extend');
            return;
        });

        $("#button_Cancel_extend").click(function(){
            hideModal('modal_extend');
            return;
        });

        $("#button_Cancel_teacher").click(function(){
            hideModal('modal_teacherTime');
            return;
        });

        $("#button_Ok_teacher").click(function(){
            var teacherBranch = $('#timeBranch').val();
            var teacherName = $('#timeTeacher').val();
            var timeStart = $('#timeStart').val();
            var timeEnd = $('#timeEnd').val();
            var courseDay = $('#courseDay').val();
            if(moment(timeStart, "HH:mm", true).isValid() && moment(timeEnd, "HH:mm", true).isValid() && courseDay.length == 1 ){
                jQuery.ajax({
                    url: "http://show981111.cafe24.com/putTeacherTime.php",
                    type: 'POST',
                    data: {
                        teacherBranch : teacherBranch,
                        teacherName : teacherName,
                        timeStart : timeStart,
                        timeEnd : timeEnd,
                        courseDay : courseDay,
                        option : "register"
                    },
                    success: function(data) {
                        console.log(data);
                        switch(data)
                        {
                            case "success":
                                alert("성공적으로 등록하였습니다.")
                                $("#calendar").fullCalendar('refetchResources');
                                break;
                            case "checkBranch":
                                alert("지점을 확인해주세요.")
                                break;
                            case "checkTeacher":
                                alert("선생님을 확인해주세요.")
                                break;
                            case "already":
                                alert("이미 등록되어 있습니다.")
                                break;
                            default:
                                alert("인터넷 연결을 확인해주세요.")
                                break;
                        }   
                        
                    },

                    error: function(xhr, textStatus, error){
                        alert("인터넷 연결을 확인해주세요.")
                        console.log(xhr.statusText);
                        console.log(textStatus);
                        console.log(error);
                    }
                });
            }else{
                alert("시간 형식을 확인해주세요.")
            }
            hideModal('modal_teacherTime');

            return;
        });

        $("#button_Delete_teacher").click(function(){
            var teacherBranch = $('#timeBranch').val();
            var teacherName = $('#timeTeacher').val();
            var timeStart = $('#timeStart').val();
            var timeEnd = $('#timeEnd').val();
            var courseDay = $('#courseDay').val();
            if(moment(timeStart, "HH:mm", true).isValid() && moment(timeEnd, "HH:mm", true).isValid() && courseDay.length == 1 ){
                jQuery.ajax({
                    url: "http://show981111.cafe24.com/putTeacherTime.php",
                    type: 'POST',
                    data: {
                        teacherBranch : teacherBranch,
                        teacherName : teacherName,
                        timeStart : timeStart,
                        timeEnd : timeEnd,
                        courseDay : courseDay,
                        option : "delete"

                    },
                    success: function(data) {
                        console.log(data);
                        switch(data)
                        {
                            case "success":
                                alert("성공적으로 삭제하였습니다.")
                                $("#calendar").fullCalendar('refetchResources');
                                break;
                            case "checkBranch":
                                alert("지점을 확인해주세요.")
                                break;
                            case "checkTeacher":
                                alert("선생님을 확인해주세요.")
                                break;
                            case "already":
                                alert("이미 등록되어 있습니다.")
                                break;
                            default:
                                alert("인터넷 연결을 확인해주세요.")
                                break;
                        }   
                        
                    },

                    error: function(xhr, textStatus, error){
                        alert("인터넷 연결을 확인해주세요.")
                        console.log(xhr.statusText);
                        console.log(textStatus);
                        console.log(error);
                    }
                });
            }else{
                alert("시간 형식을 확인해주세요.")
            }
            hideModal('modal_teacherTime');

            return;
        });

        $("#button_Cancel_TeacherInfo").click(function(){
            hideModal('modal_Teacher');
            return;
        });
        $("#button_Ok_TeacherRegister").click(function(){
            var teacherName = $('#teacherName').val();
            var teacherBranch = $('#teacherBranch').val();
            var color = $('#teacherColor').val();
            jQuery.ajax({
                    url: "http://show981111.cafe24.com/setTeacherInfo.php",
                    type: 'POST',
                    data: {
                        teacherBranch : teacherBranch,
                        teacherName : teacherName,
                        color : color,
                        option : "register"

                    },
                    success: function(data) {
                        console.log(data);
                        switch(data)
                        {
                            case "success":
                                alert("성공적으로 등록하였습니다.")
                                $("#calendar").fullCalendar('refetchEvents');
                                break;
                            case "checkBranch":
                                alert("지점을 확인해주세요.")
                                break;
                            case "already":
                                alert("이미 등록되어 있습니다.")
                                break;
                            default:
                                alert("인터넷 연결을 확인해주세요.")
                                break;
                        }   
                        
                    },

                    error: function(xhr, textStatus, error){
                        alert("인터넷 연결을 확인해주세요.")
                        console.log(xhr.statusText);
                        console.log(textStatus);
                        console.log(error);
                    }
                });
            hideModal('modal_Teacher');
            return;
        });
        $("#button_Delete_TeacherOut").click(function(){
            var teacherName = $('#teacherName').val();
            var teacherBranch = $('#teacherBranch').val();
            var color = $('#teacherColor').val();
            jQuery.ajax({
                    url: "http://show981111.cafe24.com/setTeacherInfo.php",
                    type: 'POST',
                    data: {
                        teacherBranch : teacherBranch,
                        teacherName : teacherName,
                        color : color,
                        option : "delete"

                    },
                    success: function(data) {
                        console.log(data);
                        switch(data)
                        {
                            case "success":
                                alert("성공적으로 삭제하였습니다.")
                                $("#calendar").fullCalendar('refetchEvents');
                                break;
                            case "checkBranch":
                                alert("지점을 확인해주세요.")
                                break;
                            case "already":
                                alert("이미 등록되어 있습니다.")
                                break;
                            default:
                                alert("인터넷 연결을 확인해주세요.")
                                break;
                        }   
                        
                    },

                    error: function(xhr, textStatus, error){
                        alert("인터넷 연결을 확인해주세요.")
                        console.log(xhr.statusText);
                        console.log(textStatus);
                        console.log(error);
                    }
                });
            hideModal('modal_Teacher');
            return;
        });
        $("#button_Ok_null").click(function(){
            var nullUserID = $('#nullUserID').val();
            var nullUserTeacher = $('#nullUserTeacher').val();
            var nullUserBranch = $('#nullUserBranch').val();
            jQuery.ajax({
                    url: "http://show981111.cafe24.com/putRegularForNull.php",
                    type: 'POST',
                    data: {
                        userID : nullUserID,
                        courseTeacher : nullUserTeacher,
                        courseBranch : nullUserBranch
                        
                    },
                    success: function(data) {
                        console.log(data);
                        switch(data)
                        {
                            case "success":
                                alert("성공적으로 등록하였습니다.")
                                $("#calendar").fullCalendar('refetchEvents');
                                break;
                            case "checkBranch":
                                alert("지점을 확인해주세요.")
                                break;
                            case "checkTeacher":
                                alert("선생님을 확인해주세요.")
                                break;
                            default:
                                alert("인터넷 연결을 확인해주세요.")
                                break;
                        }   
                        
                    },

                    error: function(xhr, textStatus, error){
                        alert("인터넷 연결을 확인해주세요.")
                        console.log(xhr.statusText);
                        console.log(textStatus);
                        console.log(error);
                    }
                });
            hideModal('modal_null');
            return;
        });

        $("#button_Cancel_null").click(function(){
            hideModal('modal_null');
        });
        
        
    
        $('#calendar').fullCalendar({


            

            resources: function(callback)
            {
                jQuery.ajax({
                    url: "http://show981111.cafe24.com/getResource.php",
                    type: 'POST',
                    data: {
                        userBranch:'<?php echo $userBranch; ?>',
                    },
                    success: function(data) {
                        console.log(data);
                        var output = JSON.parse(data);
                        var events = [];
                        $.each(output, function (i, item) {

                            events.push({
                                title: output[i].title,
                                id: output[i].id,
                                eventColor : output[i].eventColor,
                                businessHours : output[i].businessHours
                            });
                        })                        
                        callback(events);
                    },

                    error: function(xhr, textStatus, error){
                      console.log(xhr.statusText);
                      console.log(textStatus);
                      console.log(error);
                    }
                });
            },

            // 

            eventRender: function(event, element, view) {

                var start = moment(event.start.format("YYYY-MM-DD HH:mm"));
                var end = moment(event.end.format("YYYY-MM-DD HH:mm"));
                var duration = end.diff(start,"minutes");
                var durationForDisplay = "  [" + duration + "min" + "]";

                if(duration != 30 && event.title != '대체수업/예약해주세요')
                {
                    element.find('.fc-title').append(durationForDisplay); 
                }

            },
            events: function(start, end, timezone, callback) {
                
                console.log(start.format("YYYY-MM-DD HH:mm"));
                var option = "every";
                var findTeacher = "";
                if(searchTeacher)
                {
                    findTeacher = searchedTeacher;
                    option = "teacher";
                }else{
                    makeWhite(dowlist);
                    dowlist = [];
                }
                if(ownIDView)
                {
                    if(!userID)
                    {
                        alert("학생정보를 먼저 등록해주세요");
                        return;
                    }
                    option = "own";
                }
                if(allView)
                {
                    option = "every";
                }
                
                jQuery.ajax({
                    url: "http://show981111.cafe24.com/getAllBookedList.php",
                    type: 'POST',
                    data: {
                        fetchStart : start.format("YYYY-MM-DD HH:mm"),
                        fetchEnd: end.format("YYYY-MM-DD HH:mm"),
                        userBranch:'<?php echo $userBranch; ?>',
                        userID: userID,
                        courseTeacher: findTeacher,
                        option : option
                    
                    },
                    success: function(data) {
                        console.log(data);
                        var output = JSON.parse(data);
                        var events = [];
                        $.each(output, function (i, item) {
                    
                            events.push({
                            title: output[i].title,
                            resourceId: output[i].resourceId,// will be parsed
                            start: output[i].start, // will be parsed
                            end: output[i].end,
                            id: output[i].id,
                            rendering : output[i].rendering,
                            overlap : output[i].overlap,
                            color : output[i].color,
                            mainTeacher : output[i].mainTeacher


                            });
                            
                            
                        })
                        console.log(events);
                        callback(events);
                    },

                    error: function(xhr, textStatus, error){
                      console.log(xhr.statusText);
                      console.log(textStatus);
                      console.log(error);
                    }
                });
                jQuery.ajax({
                    url: "http://show981111.cafe24.com/getTermList.php",
                    type: 'POST',
                    data: {
                    },
                    success: function(data) {
                        console.log(data);
                        var output = JSON.parse(data);
                        $.each(output, function (i, item) {

                            termList.push({
                                termStart: output[i].termStart,
                                termEnd: output[i].termEnd,
                            });

                            if( i == 1)
                            {
                                cur_termStart = output[i].termStart;
                                cur_termEnd = output[i].termEnd;
                            }
                        })                        
                    },

                    error: function(xhr, textStatus, error){
                      console.log(xhr.statusText);
                      console.log(textStatus);
                      console.log(error);
                    }
                });
            },

            customButtons: {

                myCustomButton: {
                  text: '학생의 예약',
                  click: function() {

                        ownTeacherView = false;    
                        allView = false;
                        searchTeacher = false;
                        ownIDView = true;
                        //only show my lesson
                        $("#calendar").fullCalendar('refetchEvents');

                        
                    }
                },

                myCustomButton1: {
                  text: '선생님 검색',

                  click: function() {
                        
                        makeWhite(dowlist);
                        dowlist = [];
                        
                        var teachername = prompt("선생님이름을 입력해주세요.");
                        var exist = false;
                        if(typeof teachername != 'undefined')
                        {
                            searchedTeacher = teachername;
                            console.log(teachername);
                            jQuery.ajax({
                                url: "http://show981111.cafe24.com/getCourseTimeLine.php",
                                type: 'POST',
                                data: {
                                    userBranch:'<?php echo $userBranch; ?>'
                                },
                                success: function(data) {
                                    console.log(data);
                                    var output = JSON.parse(data);
                                    
                                    $.each(output, function (i, item) {

                                        if(searchedTeacher == output[i].courseTeacher)
                                        {
                                            exist = true;
                                            console.log(exist);
                                            if(output[i].courseDay == '월')
                                            {
                                                dowlist.push(1);
                                            }
                                            else if(output[i].courseDay == '화')
                                            {
                                                dowlist.push(2);
                                            }
                                            else if(output[i].courseDay== '수')
                                            {
                                                dowlist.push(3);
                                            }
                                            else if(output[i].courseDay == '목')
                                            {
                                                dowlist.push(4);
                                            }
                                            else if(output[i].courseDay == '금')
                                            {
                                                dowlist.push(5);
                                            }
                                            else if(output[i].courseDay== '토')
                                            {
                                                dowlist.push(6);
                                            }
                                            
                                            allView = false;
                                            ownTeacherView = false;
                                            ownIDView =false;
                                            searchTeacher = true;
                                            searchedTeacher = teachername;
                                           
                                            var dateforcolor = [];
                                            var view = $('#calendar').fullCalendar('getView');
                                            var viewstart = view.start;
                                            var viewend = view.end;

                                            for(var j = 0; j < dowlist.length; j++)
                                            {
                                                
                                                var tmp = viewstart.clone().day(dowlist[j]);
                                                if( tmp.isAfter(viewstart, 'd') ){
                                                    dateforcolor.push(tmp.format('YYYY-MM-DD'));
                                                }
                                                while( tmp.isBefore(viewend) ){
                                                    tmp.add(7, 'days');
                                                    dateforcolor.push(tmp.format('YYYY-MM-DD'));
                                                }
                                                
                                            }
                                            for(var i = 0; i < dateforcolor.length; i++)
                                            {
                                                
                                                $('.fc-day[data-date="' + dateforcolor[i] + '"]').css('background', 'Bisque');
                                            }

                                            $("#calendar").fullCalendar('refetchEvents');
                                                


                                            
                                        }

                                        
                                    })
                                    if(!exist && teachername != null)
                                    {
                                        alert("선생님 이름을 다시한번 확인해주세요!");
                                    }                        
                                },

                                error: function(xhr, textStatus, error){
                                  console.log(xhr.statusText);
                                  console.log(textStatus);
                                  console.log(error);
                                }
                            });

                        }
                        
                        
                    
                    }
                },

                myCustomButton2: {
                  text: '전체보기',
                  click: function() {
                        allView = true;
                        ownTeacherView = false;
                        ownIDView = false;
                        searchTeacher = false;
                        $("#calendar").fullCalendar('refetchEvents');
                        makeWhite(dowlist);
                        dowlist = [];
                    
                    }
                },

                myCustomButton3: {
                  text: '학생정보 등록',
                  click: function() {
                        userInfo = [];
                        userID = null;
                        userDuration = null;
                        var getUser = prompt("학생아이디를 입력하세요");
                        if(getUser)
                        {
                            console.log(getUser)
                            jQuery.ajax({
                            url: "http://show981111.cafe24.com/getUserData.php",
                            type: 'POST',
                            data: {
                                userID : getUser,
                                userBranch : userBranch
                            },
                            success: function(data) {
                                console.log(data);
                                var output = JSON.parse(data);
                                $.each(output, function (i, item) {

                                    userInfo.push({
                                        userID: output[i].userID,
                                        userBranch: output[i].userBranch,
                                        userDuration: output[i].userDuration,
                                        userName: output[i].userName
                                    });
                                    if(output[i].userID)
                                    {
                                        userID = output[i].userID;
                                    }
                                    if(output[i].userDuration)
                                    {
                                        userDuration = output[i].userDuration;
                                    }
                                })         
                                if(userInfo.length <= 0)
                                {
                                    alert("해당하는 유저가 없습니다!");
                                }else{
                                    alert(userInfo[0].userID);
                                }
                                console.log(userName)
                                console.log(userID)
                                console.log(userDuration)
                       
                            },

                            error: function(xhr, textStatus, error){
                              console.log(xhr.statusText);
                              console.log(textStatus);
                              console.log(error);
                            }
                            });

                        }
                        
                    
                    }
                },

                myCustomButton4: {
                  text: 'close',
                  click: function() {
                        showModal('modal3','rotate');
                    
                    }
                },

                myCustomButton5: {
                  text: 'open',
                  click: function() {
                        showModal('modal_open','rotate');
                    
                    }
                },
                myCustomButton6: {//지점 추가되면 수정해줘야 하는 부분이다.
                  text: '총 원비 계산',
                  click: function() {
                        var ok = 'ok';
                        
                        $.ajax({
                            url:"http://show981111.cafe24.com/fullcalendar-scheduler-1.9.4/login-system/calculateincome.php",
                            type:"POST",
                            data:{ok : ok},
                            success:function(data)
                            {
                                console.log(data);
                                var data  = $.parseJSON(data);
                                alert("잠실" + data.totalj + "\n교대" + data.totalk + "\n시청" + data.totals + "\n여의도" + data.totaly +  "\n광화문" + data.totalg +  "\n마곡" + data.totalm );                                       
                            }
                        });
                    }

                },
                myCustomButton_pushDown: {
                    text: '푸쉬내리기',
                    click: function() {
                        var paiduser = prompt("아이디, 원비, 지점을 입력해주세요.").split(",");
                        if(paiduser.length == 3)
                        {
                            var payStatus = "paid";
                            var paiduserID = paiduser[0];
                            var paiduseramount = paiduser[1];
                            var paiduserBranch = paiduser[2];
                            
                            $.ajax({

                                url:"http://show981111.cafe24.com/fullcalendar-scheduler-1.9.4/login-system/setpaid.php",
                                type:"POST",
                                data:{userID: paiduserID, payStatus: payStatus, amount: paiduseramount, userBranch: paiduserBranch },
                                                                   
                                success:function(data)
                                {
                                    console.log(data);
                                    $("#calendar").fullCalendar('refetchEvents');
                                    var data  = $.parseJSON(data);
                                    if( data.status == 'error')
                                    {
                                        alert("존재하지 않는 아이디입니다.");
                                    }
                                    else
                                    {
                                        alert("updated Successfully");
                                                       
                                    }                               
                                }
                            });

                            
                        }else
                        {
                            alert("정보를 3개 입력하세요!");
                        }

                    }
                },
                myCustomButton_pushUp: {
                    text: '푸쉬띄우기',
                    click: function() {
                        //총원비 합을 PASTINCOME 에 삽입 
                        var checkalert = confirm("원비 푸쉬를 띄우시겠습니까?");
                        if(checkalert)
                        {
                            var checktwice = confirm("진짜?");
                            if(checktwice)
                            {
                                var payStatus = "unpaid";
                                
                                $.ajax({

                                    url:"http://show981111.cafe24.com/fullcalendar-scheduler-1.9.4/login-system/updatepaystatus.php",
                                    type:"POST",
                                    data:{payStatus: payStatus},
                                                                       
                                    success:function(data)
                                    {
                                        console.log(data);
                                        $("#calendar").fullCalendar('refetchEvents');
                                        var data  = $.parseJSON(data);
                                        if( data.status == 'error')
                                        {
                                            alert("ERROR.");
                                        }
                                        else{
                                            alert("alerted Successfully");
                                            var ok = 'ok';
                                
                                            $.ajax({

                                                url:"http://show981111.cafe24.com/fullcalendar-scheduler-1.9.4/login-system/initializeincome.php",
                                                type:"POST",
                                                data:{ok : ok},
                                                                                   
                                                success:function(data)
                                                {
                                                    console.log(data);
                                                    if(data.status == 'success')
                                                    {
                                                        alert("initialized Successfully");
                                                    }else
                                                    {
                                                        alert("ERROR.");
                                                    }                   
                                                                                        
                                                                                        
                                                }
                                            });
                                                           
                                        }                     
                                    }
                                });
                            }

                        }else
                        {
                            alert("canceled")
                        }
                    }
                  },

                  myCustomButton_backup : {
                        text : "매출 백업",
                        click : function(){
                            var check = confirm("백업하시겠습니까?");
                            if(!check)
                            {
                                return;
                            }
                            $.ajax({

                                url:"http://show981111.cafe24.com/backupIncome.php",
                                type:"POST",                 
                                success:function(data)
                                {
                                    console.log(data);
                                    var output  = $.parseJSON(data);
                                    var message = "";
                                    $.each(output, function (i, item) {
                                        message = message + output[i].branch + " " + output[i].income + "\n";
                                    })
                                    alert(message);
                                                                          
                                }
                            });
                        }

                  },

                  myCustomButton_extend : {
                        text : "학기 연장",
                        click : function(){
                            showModal('modal_extend','rotate');
                        }

                  },
                  myCustomButton_extendRest : {
                        text : "남은 인원 연장",
                        click : function(){
                            var check = confirm("연장하시겟습니까?");
                            if(!check)
                            {
                                return;
                            }
                            $.ajax({
                                url:"http://show981111.cafe24.com/extendRest.php",
                                type:"POST",                 
                                success:function(data)
                                {
                                    console.log(data);
                                    if(data == "success")
                                    {
                                        alert("성공적으로 연장하였습니다.");
                                        $("#calendar").fullCalendar('refetchEvents');
                                    }else{
                                        alert("실패하였습니다.");
                                    }
                                }
                            });
                        }

                  },
                  button_registerTeacher : {
                    text: "선생님 시간대 등록/제거",
                    click: function(){
                        showModal('modal_teacherTime','rotate');                                
                    }
                  },
                  button_TeacherInfo : {
                    text: "선생님 등록/제거",
                    click: function(){
                        showModal('modal_Teacher','rotate');                                
                    }
                  },

                  button_quitStudent : {
                    text: "학생 비활성화",
                    click: function(){
                        var deleteUser = prompt("학생아이디를 입력해주세요.");
                        if(deleteUser)
                        {
                            $.ajax({
                                url:"http://show981111.cafe24.com/deleteStudent.php",
                                type:"POST",
                                data:{userID: deleteUser},
                                                                   
                                success:function(data)
                                {
                                    console.log(data);
                                    if(data == "success"){
                                        alert("성공적으로 삭제하였습니다.");
                                    }else{
                                        alert("실패하였습니다. 아이디를 다시한번 확인해주세요.");
                                    }                              
                                }
                            });
                        }                          
                    }
                  },
                  button_activeStudent : {
                    text: "학생 활성화",
                    click: function(){
                        var activeUser = prompt("학생아이디를 입력해주세요.");
                        if(activeUser)
                        {
                            $.ajax({
                                url:"http://show981111.cafe24.com/activeStudent.php",
                                type:"POST",
                                data:{userID: activeUser},
                                                                   
                                success:function(data)
                                {
                                    console.log(data);
                                    if(data == "success"){
                                        alert("성공적으로 활성화하였습니다.");
                                    }else{
                                        alert("실패하였습니다. 아이디를 다시한번 확인해주세요.");
                                    }                              
                                }
                            });
                        }                          
                    }
                  },
                  button_resetCredit : {
                    text: "크레딧 초기화",
                    click: function(){
                        var checkalert = confirm("크레딧을 초기화 하시겟습니까?");
                        if(checkalert)
                        {
                            $.ajax({
                                url:"http://show981111.cafe24.com/resetCredit.php",
                                type:"POST",                   
                                success:function(data)
                                {
                                    console.log(data);
                                    if(data == "success"){
                                        alert("성공적으로 초기화했습니다.");
                                    }else{
                                        alert("실패하였습니다.");
                                    }                              
                                }
                            });
                        }                          
                    }
                  },
                  button_registerNull : {
                    text: "널 등록",
                    click: function(){
                        showModal('modal_null','rotate');
                    }
                  }
                
              },

            selectable:true,
            selectHelper:true,
            // selectOverlap : function(event) { 백그라운드 이벤트 셀렉 못하게하는것... 클로즈 구현
            //     console.log(event.rendering)
            //     //console.log(event.color)
            //     if(event.rendering == 'background')
            //     {
                    
            //         return false;
            //     }else
            //     {
            //         return true;
            //     }
            // },


            
            // eventConstraint : "businessHours",
            // selectConstraint: "businessHours",
            select: function(start,  allDay, event, view, resource )
            {
                if(view.name == 'month' || view.name == 'agendaWeek')
                {
                    // var gotoDate = moment(start).format("YYYY-MM-DD");
                    // $('#calendar').fullCalendar('changeView', 'timelineDay', gotoDate);

                    return true;
                }
                
                
                
                var teacher = resource.id;
                
                var selectStart = moment(start).format("YYYY-MM-DD HH:mm");
                console.log(selectStart);
        
                showModal('modal1', 'rotate');

                day_teacher = teacher;
                console.log(day_teacher);
                day_selectStart = selectStart;
                
            }, 

            eventClick:function(calEvent, jsEvent, view)
            {
                showModal('modal2', 'rotate');
            
                var openString = moment(calEvent.start).format("YYYY-MM-DD HH:mm");
                var endString = moment(calEvent.end).format("YYYY-MM-DD HH:mm");
                console.log(openString);
                console.log(endString)
                event_Teacher = calEvent.resourceId;
                event_title = calEvent.title;
                event_Start = openString;
                event_End = endString;
            },

        


            eventLimit: true,
            views: {
                month: {
                    eventLimit: 5
                }
            },
            

            dayClick: function(date, jsEvent, view) {
                console.log("clicked");
                var clickedDate = moment(date);
                console.log(date);
                if (view.name != "month" && view.name != "agendaWeek")
                {
                    console.log(view.name)
                    return;
                }else if (view.name == "month" || view.name == "agendaWeek") {
                    $('#calendar').fullCalendar('changeView', 'timelineDay');
                    $('#calendar').fullCalendar('gotoDate', clickedDate);
                    
                }

            },



            minTime: "09:00:00",
            maxTime: "22:30:00",
            slotDuration: '00:15:00',
            
            eventOverlap : false,
            

            schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source',
            
            defaultDate: $('#calendar').fullCalendar('today'), 
            
            nowIndicator: true,
            editable: '<?php echo $admin; ?>', // enable draggable events
            aspectRatio: 1.8,
            monthNames: ["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],
            monthNamesShort: ["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],
            dayNames: ["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],
            dayNamesShort: ["일","월","화 ","수 ","목 ","금 ","토 "],      ///한글로변환
            buttonText: {
                today : "오늘",
                month : "월",
                week : "주",
                day : "예약",

            },   
            scrollTime: '09:00', // undo default 6am scrollTime
            header: {
                left: ' today, timelineDay,agendaWeek,month prev,next',
                center: 'title',
                right: 'myCustomButton2, myCustomButton1, myCustomButton, myCustomButton3' //agendaDay <-> timelineDay 
            },

            footer: {
                right: 'myCustomButton4, myCustomButton5, myCustomButton6, myCustomButton_pushDown, myCustomButton_backup, myCustomButton_extend, myCustomButton_extendRest, button_registerTeacher, button_TeacherInfo, button_quitStudent, button_activeStudent ,button_resetCredit, button_registerNull',
                left : 'myCustomButton_pushUp'
            },



         
        


            defaultView: 'month',
            resourceLabelText: '강사',
            //resources: 'resource_J.php',
            resourceAreaWidth: "10%",

          
            
         
          

           
        }).on('click', '.fc-month-button', function() {
            allView = false;
            ownTeacherView = true;
            ownIDView = false;
            searchTeacher = false;
            var dateforcolor = [];
            var view = $('#calendar').fullCalendar('getView');
            var viewstart = view.start;
            var viewend = view.end;

            for(var j = 0; j < dowlist.length; j++)
            {
                                    
                var tmp = viewstart.clone().day(dowlist[j]);
                if( tmp.isAfter(viewstart, 'd') ){
                    dateforcolor.push(tmp.format('YYYY-MM-DD'));
                }
                while( tmp.isBefore(viewend) ){
                    tmp.add(7, 'days');
                    dateforcolor.push(tmp.format('YYYY-MM-DD'));
                }
                                    
            }
            for(var i = 0; i < dateforcolor.length; i++)
            {
                                    
                $('.fc-day[data-date="' + dateforcolor[i] + '"]').css('background', 'Bisque');
            }
            $("#calendar").fullCalendar('refetchEvents');      
            
        });

        

          
    
    });



 
</script>
<style>
    
     .modalWindow_container {
       perspective: 1300px;
        position: absolute;
        font-family: Arial, Helvetica, sans-serif;
       width:100%;
       height:100%;
       top:0px;
       left:0px;
        pointer-events:none;
        z-index: 99999;
        opacity:0;
         transition: opacity 400ms;
         background:rgba(0,0,0,0.8);
     }
     
    .modalWindow {
        transform-origin: 50% 50%;
        transform-style: preserve-3d;
        height:auto;
        box-shadow: 5px 5px 5px 5px rgba(0, 0, 0, 0.3);
        position: absolute;
        top:calc(50% - 100px);
        left:calc(50% - 100px);
        margin: auto;
        padding: 5px 20px 13px 20px;
        border-radius: 0px;
        background: #fff;
    }

    .modalButton {
        margin-top: 10px;
        padding: 10px;
    }
    .datepicker {
        margin-top: 10px;
        padding: 10px;
    }
    body {
        margin: 0;
        padding: 0;
        font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
        font-size: 17px;
    }
 
    #calendar {
        max-width: 1500px;
        margin: 40px auto;
    }
 
</style>


</head>


<body>
    
    
    <div class="container">

     <div id='calendar'></div>
    </div>
</body>
</html>